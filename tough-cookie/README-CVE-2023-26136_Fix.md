# Fixed Tough-Cookie Library

This project addresses the critical vulnerability [CVE-2023-26136](https://nvd.nist.gov/vuln/detail/CVE-2023-26136) in the `tough-cookie` library, which was susceptible to prototype pollution due to improper handling of cookies when using `CookieJar` in `rejectPublicSuffixes=false` mode. This issue arose from the manner in which the objects were initialized. :contentReference[oaicite:0]{index=0}


## Fix Details

- **Vulnerability Addressed**: Prototype Pollution in `tough-cookie` versions prior to 4.1.3.
- **Fix Implemented**: Refactored the initialization of objects within the `CookieJar` to prevent prototype pollution.
- **Technologies Used**: JavaScript, Node.js, npm.

## A changes.diff file with my changes compared to the tough-cookie 2.5.0 git tag.

## An index.js file exploiting the vulnerability. Notice that:
- **After running npm install tough-cookie@2.5.0 && node index.js, the output should be EXPLOITED SUCCESSFULLY.
- **After running npm install ./tough-cookie-2.5.0-PATCHED.tgz && node index.js, the output should be EXPLOIT FAILED.
- **Comments explaining the triggered vulnerability and its potential impact have been included.
- **Node version: 20.

## To run the Unit tests, use the following command: npm test.

## Code Changes

### `memstore.js`

- **Issue**: The `memstore.js` file contained object initializations that were vulnerable to prototype pollution.
- **Fix**: Refactored the object initialization to prevent prototype pollution.

  // Before
  this.idx = {};

  // After - to avoid inherited properties or methods from Object.prototype, which prevents malicious properties from being injected into the prototype chain.
  this.idx = Object.create(null);

### `cookie_jar_test.js`

- **Issue**: The test cases in cookie_jar_test.js did not cover scenarios involving prototype pollution.
- **Fix**: Added test cases to ensure that the CookieJar handles cookies securely, preventing prototype pollution.

### `parser.json`

- **Issue**: The `Expires` attribute in the cookie was set to a past date (`Fri, 07 Aug 2019 08:04:19 GMT`), causing the cookie to expire prematurely during tests.
- **Fix**: The `Expires` attribute was updated to a far future date (`Fri, 07 Aug 9999 08:04:19 GMT`) to ensure the cookie remains valid during the testing 
           process and avoids premature expiration in the test environment.

  // Before
  - From: `"foo=bar; Expires=Fri, 07 Aug 2019 08:04:19 GMT"`

  // After
  - To: `"foo=bar; Expires=Fri, 07 Aug 9999 08:04:19 GMT"`
